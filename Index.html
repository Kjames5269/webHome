<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
   <head>
      <title>Home Page</title>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <link rel='stylesheet' href='file.css' />
   </head>

  <body>
    <div id=container>
      <div id='mangaContainer'>
        <form id='mangaList' action="./readManga.html" method="get">

        </form>
      </div>
      <img src='flcl.jpg' alt='pic' />
      <table class='center'>
        <tr id='row0'>
          <th><em><a id='mail' href='https://mail.google.com/mail/u/0/#inbox'>Mail</a></em></th>
          <td colspan='6'>
            <form class='search' action='https://www.google.com/search'>
              <input class='search' id='searchbar' type='text' name='q'
              value='' placeholder='Google Search' autocomplete='off'
			  autofocus />
            </form>
          </td>
        <tr id='row1'>
          <th><em>Life</em></th>
          <th class=divider>|</th>
          <th><a href='https://www.chase.com/'>Chase</a></th>
          <th><a href='https://www.americanexpress.com/'>Amex</a></th>
		  <th><a href='https://www.amazon.com/'>Amazon</a></th>
		  <th><a href='https://drive.google.com/drive/u/1/shared-with-me'>Drive</a></th>
		  <th><a href='https://www.kickstarter.com/discover/categories/games?ref=discovery_overlay'>KS</a></th>
        </tr>
        <tr id='row2'>
          <th><em>Boards</em></th>
          <th class=divider>|</th>
          <th><a href='https://www.reddit.com/'>Reddit</a></th>
          <th><a href='https://www.reddit.com/r/anime/'>r/anime</a></th>
		  <th><a href='https://www.reddit.com/r/rarepuppers/'>puppers</a></th>
          <th><a href='http://boards.4chan.org/w/'>/w</a></th>
          <th><a href='http://boards.4chan.org/wg/'>/wg</a></th>
        </tr>
        <tr id='row3'>
          <th><em>Coding</em></th>
          <th class=divider>|</th>
          <th><a href='https://github.com/'>Github</a></th>
          <th><a href='https://discord.js.org/#/docs/main/stable/general/welcome'>Discord.js</a></th>
	      <th><a href='https://piazza.com/class/j68ihpivj7f3s8'>Piazza</a></th>
	      <th><a href='./Databases.pdf'>Db book</a></th>
	      <th><a href='http://www.learncpp.com/'>C ++</a></th>
        </tr>
        <tr id='row4'>
          <th><em>School</em></th>
          <th class=divider>|</th>
          <th><a href='https://www2.cs.arizona.edu/classes/cs560/fall17/'>Csc 560</a></th>
          <th><a href='https://www2.cs.arizona.edu/classes/cs210/fall17/'>Csc 210</a></th>
          <th><a href='https://d2l.arizona.edu/d2l/home'>D2l</a></th>
          <th><a href='http://ista230.com/'>Ista</a></th>
		  <th><a href='https://www.uaccess.arizona.edu/'>Uaccess</a></th>
        </tr>
        <tr id='row5'>
          <th><em>Streams</em></th>
          <th class=divider>|</th>
          <th><a href='https://www.youtube.com/'>Youtube</a></th>
          <th><a href='http://kissanime.ru/'>Anime</a></th>
          <th><a href='https://www.twitch.tv/'>Twitch</a></th>
		  <th><a href='http://horriblesubs.info/'>Torrents</a></th>
		  <th><a href='https://www.hulu.com/'>Ads</a></th>
        </tr>
      </table>
      <div id='thanksMangaEden'>
         <p>
           Special thanks to <a href='http://www.mangaeden.com'>http://www.mangaeden.com</a>
           for api's!
        </p>
      </div>
    </div>

    <script>
    //  I NEED A SERVER desperatly
    const mangaArr = [
        { name:'Made in Abyss', id:'570076f4719a168120d7ea0a', ch:43 },
		{ name:'Shingeki no Kyojin', id:'4e70ea6ac092255ef7006a52', ch:99 }
      ];

	function namePrep(name) {
		name = name.toLowerCase();
		name = name.replace(/ /g, '-');
		return name;
	}
	  
	function getId(name) {
		name = namePrep(name);
		console.log(name);
		
		var request = new XMLHttpRequest();
		request.open('GET', 'http://www.mangaeden.com/api/list/0/', true);
		request.onreadystatechange = function(){
			if (request.readyState === 4 && request.status === 200 ){
				var response = JSON.parse(request.response)
				var manga = response.manga.filter(function(e) {
					return e.a == name;
				});
				console.log(manga[0].i);
			}
		};
		request.send();
	}

	function checkIfOut(docId, manga) {
		var request = new XMLHttpRequest();
		request.open('GET', 'http://www.mangaeden.com/api/manga/' + manga.id, true);
		request.onreadystatechange = function(){
		if (request.readyState === 4 && request.status === 200){
			var response = JSON.parse(request.response)
			var latestChapter = response.chapters[0][0];
			var charr = response.chapters[0];
			var chName=charr[2].split(/[^A-Za-z ]/)[0];
				if (latestChapter == manga.ch ) {
					//  0 chapter, 1 nonsense, 2 name, 3 id
					console.log(response.chapters[0]);
					docId.innerHTML += "<button type=\"submit\" value=\"" + charr[3] +
					"\" name=\""+ namePrep("Chapter " +charr[0] + " " + chName) + "\">" +
					manga.name +"</button>";
				}
			}
		};
		request.send();
	}

	function getMangas() {
		var doc = document.getElementById("mangaList");
		mangaArr.forEach(function(e) {
			checkIfOut(doc,e);
		});
	}
	
	getMangas();
	
    </script>
  </body>
</html>
