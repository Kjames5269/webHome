<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
		<title>Manga Page</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link rel='stylesheet' href='file.css' />
		
	</head>

	<body>
		<div id="mangaReader">
		</div>
	</body>
	
	<script>
	
		function populateChapter(doc, id) {
			var request = new XMLHttpRequest();
			request.open('GET', 'http://www.mangaeden.com/api/chapter/' + id, true);
			request.onreadystatechange = function(){
			if (request.readyState === 4 && request.status === 200){
				var response = JSON.parse(request.response);
				var images = response.images.reverse();
				images.forEach(function (e) {
					doc.innerHTML += "<img src=\"https://cdn.mangaeden.com/mangasimg/" + e[1] + "\" alt=\"chapter_" + e[0] + "\"/>";
				});

				console.log(response);
					
				}
			};
			request.send();
		}
	
		var chapterID=-1;
		var url = location.href;
		if(!url.includes('?')) {
			document.getElementById("mangaReader").innerHTML = "No Chapter found";
		}
		else {
		//  Horribly bad but w.e.
			
			var vars = url.substring(url.indexOf("?")+1);
			var arr = vars.split("=");
			
			chapterID = arr[1];
			var name = arr[0];
						
			var doc = document.getElementById("mangaReader");
			doc.innerHTML = "<h1>" + name.replace(/-/g, ' ') + "</h1>";
			
			console.log(chapterID);
			populateChapter(doc, chapterID); 
		}
		
		
		
	</script>
	
</html>